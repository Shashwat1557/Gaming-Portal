<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Dodge the Blocks</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #111;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    #game-container {
      border: 2px solid #444;
      border-radius: 8px;
      background: #000;
      padding: 10px;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
      text-align: center;
    }

    canvas {
      display: block;
      background: #181818;
      border-radius: 4px;
    }

    #info {
      margin-top: 8px;
      font-size: 14px;
      opacity: 0.8;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <canvas id="game" width="400" height="600"></canvas>
    <div id="info">
      Move: <b>← →</b> or <b>A/D</b> &nbsp;|&nbsp;
      Restart: <b>Space</b>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const width = canvas.width;
    const height = canvas.height;

    // Player settings
    const player = {
      x: width / 2 - 20,
      y: height - 60,
      w: 40,
      h: 40,
      speed: 6,
      dx: 0
    };

    // Enemy blocks
    let enemies = [];

    // Game state
    let score = 0;
    let lastTime = 0;
    let spawnTimer = 0;
    let gameOver = false;

    // Keyboard input
    const keys = {
      left: false,
      right: false
    };

    document.addEventListener("keydown", (e) => {
      if (e.code === "ArrowLeft" || e.code === "KeyA") {
        keys.left = true;
      }
      if (e.code === "ArrowRight" || e.code === "KeyD") {
        keys.right = true;
      }

      if (e.code === "Space" && gameOver) {
        restartGame();
      }
    });

    document.addEventListener("keyup", (e) => {
      if (e.code === "ArrowLeft" || e.code === "KeyA") {
        keys.left = false;
      }
      if (e.code === "ArrowRight" || e.code === "KeyD") {
        keys.right = false;
      }
    });

    function restartGame() {
      score = 0;
      enemies = [];
      gameOver = false;
      player.x = width / 2 - player.w / 2;
      lastTime = performance.now();
      spawnTimer = 0;
      loop(lastTime);
    }

    function updatePlayer() {
      player.dx = 0;
      if (keys.left) player.dx = -player.speed;
      if (keys.right) player.dx = player.speed;

      player.x += player.dx;

      // Stay inside screen
      if (player.x < 0) player.x = 0;
      if (player.x + player.w > width) player.x = width - player.w;
    }

    function spawnEnemy() {
      const enemyWidth = 40;
      const x = Math.random() * (width - enemyWidth);
      const speed = 2 + Math.random() * 4;

      enemies.push({
        x,
        y: -50,
        w: enemyWidth,
        h: 40,
        speed
      });
    }

    function updateEnemies(delta) {
      // Move enemies
      enemies.forEach((e) => {
        e.y += e.speed;
      });

      // Remove off-screen enemies
      enemies = enemies.filter((e) => e.y < height + 60);

      // Spawn new enemies over time
      spawnTimer += delta;
      // Spawn every 600 ms (faster as score increases)
      const spawnInterval = Math.max(250, 600 - score * 2);
      if (spawnTimer > spawnInterval) {
        spawnEnemy();
        spawnTimer = 0;
      }
    }

    function checkCollision(a, b) {
      return (
        a.x < b.x + b.w &&
        a.x + a.w > b.x &&
        a.y < b.y + b.h &&
        a.y + a.h > b.y
      );
    }

    function updateScore(delta) {
      // delta is in ms, convert to seconds
      score += delta * 0.01; // smaller factor = slower score growth
    }

    function drawPlayer() {
      ctx.fillStyle = "#3b82f6"; // blue
      ctx.fillRect(player.x, player.y, player.w, player.h);
    }

    function drawEnemies() {
      ctx.fillStyle = "#ef4444"; // red
      enemies.forEach((e) => {
        ctx.fillRect(e.x, e.y, e.w, e.h);
      });
    }

    function drawScore() {
      ctx.fillStyle = "#fff";
      ctx.font = "18px system-ui, sans-serif";
      ctx.textAlign = "left";
      ctx.fillText("Score: " + Math.floor(score), 10, 24);
    }

    function drawGameOver() {
      ctx.fillStyle = "rgba(0, 0, 0, 0.6)";
      ctx.fillRect(0, 0, width, height);

      ctx.fillStyle = "#fff";
      ctx.textAlign = "center";

      ctx.font = "36px system-ui, sans-serif";
      ctx.fillText("Game Over", width / 2, height / 2 - 20);

      ctx.font = "20px system-ui, sans-serif";
      ctx.fillText("Score: " + Math.floor(score), width / 2, height / 2 + 10);
      ctx.fillText("Press Space to restart", width / 2, height / 2 + 40);
    }

    function loop(timestamp) {
      if (gameOver) return;

      const delta = timestamp - lastTime;
      lastTime = timestamp;

      // Update
      updatePlayer();
      updateEnemies(delta);
      updateScore(delta);

      // Collision detection
      for (const e of enemies) {
        if (checkCollision(player, e)) {
          gameOver = true;
          break;
        }
      }

      // Draw
      ctx.clearRect(0, 0, width, height);
      drawPlayer();
      drawEnemies();
      drawScore();

      if (gameOver) {
        drawGameOver();
        return;
      }

      requestAnimationFrame(loop);
    }

    // Start the game
    lastTime = performance.now();
    requestAnimationFrame(loop);
  </script>
</body>
</html>